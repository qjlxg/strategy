name: Stock Scanner Backtest Workflow

on:
  workflow_dispatch: # æ”¯æŒæ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ
  push:
    paths:
      - 'stock_scanner_go.py'
      - 'backtest_stock_scanner_go.py'
      - '.github/workflows/backtest_stock_scanner_go.yml'

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install pandas numpy pytz

      - name: Execute Scanner and Backtest
        env:
          TZ: 'Asia/Shanghai' # å¼ºåˆ¶ä¸Šæµ·æ—¶åŒº
        run: |
          mkdir -p results
          python stock_scanner_go.py
          python backtest_stock_scanner_go.py

      - name: Push Results to Repository
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add results/*.csv
          # ä»…åœ¨æœ‰å†…å®¹å˜åŒ–æ—¶æäº¤ï¼Œé¿å…å·¥ä½œæµæŠ¥é”™
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ“Š è‡ªåŠ¨æ›´æ–°æ‰«æä¸å›æµ‹æŠ¥å‘Š [$(date '+%Y-%m-%d %H:%M')]" && git push)
